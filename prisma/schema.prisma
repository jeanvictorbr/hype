generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Tabela base da Guilda
model Guild {
  id              String   @id
  autoVoiceConfig AutoVoiceConfig?
  ticketConfig    TicketConfig?
  vipExpiresAt    DateTime?
  features        String[] @default([])
}
// ðŸ“¦ MÃ“DULO: TICKETS (Tickets Ativos)
model ActiveTicket {
  channelId       String   @id // ID do canal de texto do ticket
  ownerId         String       // ID do membro que abriu
  guildId         String       // ID do servidor
}
// ðŸ“¦ MÃ“DULO: AUTO-VOICE (ConfiguraÃ§Ãµes do Painel /hype)
model AutoVoiceConfig {
  guildId         String   @id
  guild           Guild    @relation(fields: [guildId], references: [id], onDelete: Cascade)
  
  triggerChannel  String?  // ID do Canal gatilho
  tempCategory    String?  // ID da Categoria para as salas
  bypassRoles     String[] // Array com IDs dos cargos que tÃªm Passe Livre nas salas trancadas
}

// ðŸ“¦ MÃ“DULO: AUTO-VOICE (Salvar Salas Ativas para nÃ£o perder no restart da Discloud)
model AutoVoiceRoom {
  channelId       String   @id // ID do canal de voz temporÃ¡rio criado
  ownerId         String       // ID do dono da sala
  guildId         String       // ID do servidor
}

model TicketConfig {
  guildId         String   @id
  guild           Guild    @relation(fields: [guildId], references: [id], onDelete: Cascade)
  
  logChannel      String?
  ticketCategory  String?
  staffRoles      String[]
  
  // Relacionamento com Departamentos
  departments     TicketDepartment[]
  
  // PersonalizaÃ§Ã£o da Vitrine (Painel PÃºblico)
  panelTitle      String   @default("ðŸ“© Central de Atendimento")
  panelDescription String  @default("Precisa de suporte? Selecione uma opÃ§Ã£o abaixo para falar com a nossa equipa.")
  panelFooter     String?  
  panelImage      String?
}

model TicketDepartment {
  id              String       @id @default(uuid())
  guildId         String
  config          TicketConfig @relation(fields: [guildId], references: [guildId], onDelete: Cascade)
  
  label           String       // Ex: Financeiro, Suporte
  description     String?      // Ex: Problemas com pagamentos
  emoji           String?      // Ex: ðŸ’°
  
  createdAt       DateTime     @default(now())
}